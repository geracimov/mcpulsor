version: "3.9"
name: mcpulsor-server-and-inspector

services:
  # -------- HTTP: Java MCP server -----------------------------
  server-http:
    build:
      context: ..                  # <= REPO ROOT
      dockerfile: ./mcpulsor/mcpulsor-server/Dockerfile
      target: http
      args:
        MODULE_DIR: ./mcpulsor/mcpulsor-server
        #MAIN_CLASS: edu.borisov.mcpulsor.server.McpulsorServerApplication
    image: mcpulsor-server:http
    container_name: mcpulsor-server-http
    expose:
      - "8091"
    ports:
      - "8091:8091"                # optional: call from host too

  #   -------- Inspector for the HTTP server (UI -> localhost:6274) ---------------------
  inspector-http:
    image: ghcr.io/modelcontextprotocol/inspector:latest
    container_name: mcp-inspector-http
    depends_on:
      - server-http
    environment:
      HOST: "0.0.0.0"
      ALLOWED_ORIGINS: "http://localhost:6274,http://0.0.0.0:6274"
    ports:
      - "6274:6274"                # Inspector UI (http)
      - "6277:6277"                # Inspector proxy (http)
  ollama:
    image: ollama/ollama
    container_name: ollama2
    ports:
      - "11431:11434"
    volumes:
      - ./ollama:/root/.ollama
    entrypoint: >
      /bin/sh -c "
        ollama serve &
        sleep 2 &&
        ollama pull gemma3:4b-it-q4_K_M &&
        ollama pull PetrosStav/gemma3-tools:4b &&
        wait
      "
    restart: unless-stopped
